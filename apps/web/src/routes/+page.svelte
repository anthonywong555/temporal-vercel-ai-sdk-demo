<script lang="ts">
  import { goto } from '$app/navigation';
  import WorkflowChat from '$lib/components/workflow-chat.svelte';
  import { ScrollArea } from "$lib/components/ui/scroll-area/index.js";
  import {
    PromptInput,
    PromptInputBody,
    PromptInputSubmit,
    PromptInputTextarea,
    PromptInputToolbar,
	type PromptInputMessage,
  } from "$lib/components/ai-elements/prompt-input";
  import { createChat } from "./chat/data.remote";
	import type { PageData } from './$types';

  let { data }: { data: PageData } = $props();

  async function startChat({workflowType, prompt}: {workflowType: string, prompt: string}) {
    const id = crypto.randomUUID();
    const workflowId = await createChat({
      id,
      prompt,
      workflowType
    });
    await goto(`/chat/${workflowId}`);
  }

  async function handleSubmit (message: PromptInputMessage) {
    const { text } = message;
    const id = crypto.randomUUID();

    if(text) {
      const workflowId = await createChat({
        id,
        prompt: text,
        workflowType: 'toolCallingStreaming'
      });

      await goto(`/chat/${workflowId}`);
    }
  }
</script>

<ScrollArea class="h-[79vh] w-[full] rounded-md border p-4">
  <WorkflowChat workflows={data.workflows} {startChat}/>
</ScrollArea>
<PromptInput onSubmit={handleSubmit}>
  <PromptInputBody>
    <PromptInputTextarea placeholder="📖 Choose Your Own Adventure ⚔️" />
  </PromptInputBody>
  <PromptInputToolbar class="flex justify-end">
    <PromptInputSubmit />
  </PromptInputToolbar>
</PromptInput>